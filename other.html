<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>График работы сотрудников</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .schedule-cell {
            transition: all 0.2s ease;
        }
        .schedule-cell:hover {
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .scroll-container {
            scroll-behavior: smooth;
        }
        .admin-panel {
            max-height: 80vh;
            overflow-y: auto;
        }
        .overtime-input {
            width: 80px;
        }
        .fade-enter-active, .fade-leave-active {
            transition: opacity 0.3s;
        }
        .fade-enter, .fade-leave-to {
            opacity: 0;
        }
        .login-modal {
            transition: all 0.3s ease;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <header class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold text-indigo-700">График работы сотрудников</h1>
            <button id="toggle-admin" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition">
                Админ-панель <i class="fas fa-lock ml-1"></i>
            </button>
        </header>

        <!-- Main Content -->
        <div id="main-content">
            <!-- Employee Selector -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <div class="flex flex-wrap items-center gap-4">
                    <div class="w-full md:w-auto">
                        <label for="employee-select" class="block text-sm font-medium text-gray-700 mb-1">Выберите сотрудника:</label>
                        <div class="relative">
                            <select id="employee-select" class="block w-full md:w-64 px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="all">Все сотрудники</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="w-full md:w-auto">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Неделя:</label>
                        <div class="flex items-center gap-2">
                            <button id="prev-week" class="bg-gray-200 hover:bg-gray-300 p-2 rounded-full">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <span id="week-display" class="font-medium">Загрузка...</span>
                            <button id="next-week" class="bg-gray-200 hover:bg-gray-300 p-2 rounded-full">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Schedule Table -->
            <div class="bg-white rounded-lg shadow-md overflow-hidden">
                <div class="overflow-x-auto">
                    <table id="schedule-table" class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Сотрудник</th>
                                <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Понедельник</th>
                                <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Вторник</th>
                                <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Среда</th>
                                <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Четверг</th>
                                <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Пятница</th>
                                <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Суббота</th>
                                <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Воскресенье</th>
                            </tr>
                        </thead>
                        <tbody id="schedule-body" class="bg-white divide-y divide-gray-200">
                            <tr>
                                <td colspan="8" class="px-6 py-4 text-center text-gray-500">Загрузка данных...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Login Modal -->
        <div id="login-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 login-modal">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-md">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-indigo-700">Вход в админ-панель</h2>
                        <button id="close-login" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times text-2xl"></i>
                        </button>
                    </div>
                    
                    <form id="login-form">
                        <div class="mb-4">
                            <label for="username" class="block text-sm font-medium text-gray-700 mb-1">Логин:</label>
                            <input type="text" id="username" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500" required>
                        </div>
                        
                        <div class="mb-6">
                            <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Пароль:</label>
                            <input type="password" id="password" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500" required>
                        </div>
                        
                        <div id="login-error" class="text-red-500 text-sm mb-4 hidden">Неверный логин или пароль</div>
                        
                        <button type="submit" class="w-full bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition">
                            Войти <i class="fas fa-sign-in-alt ml-1"></i>
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Admin Panel (Hidden by default) -->
        <div id="admin-panel" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-6xl admin-panel">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-indigo-700">Административная панель</h2>
                        <button id="close-admin" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times text-2xl"></i>
                        </button>
                    </div>

                    <!-- Tabs -->
                    <div class="border-b border-gray-200 mb-6">
                        <div class="flex space-x-8">
                            <button id="schedule-tab" class="tab-button active py-4 px-1 border-b-2 border-indigo-500 font-medium text-sm text-indigo-600">График работы</button>
                            <button id="employees-tab" class="tab-button py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300">Сотрудники</button>
                            <button id="overtime-tab" class="tab-button py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300">Овертаймы</button>
                        </div>
                    </div>

                    <!-- Schedule Admin -->
                    <div id="schedule-admin-content" class="tab-content">
                        <div class="mb-6 flex flex-wrap items-center gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Неделя:</label>
                                <div class="flex items-center gap-2">
                                    <button id="admin-prev-week" class="bg-gray-200 hover:bg-gray-300 p-2 rounded-full">
                                        <i class="fas fa-chevron-left"></i>
                                    </button>
                                    <span id="admin-week-display" class="font-medium">Загрузка...</span>
                                    <button id="admin-next-week" class="bg-gray-200 hover:bg-gray-300 p-2 rounded-full">
                                        <i class="fas fa-chevron-right"></i>
                                    </button>
                                </div>
                            </div>
                            <div>
                                <button id="save-schedule" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition">
                                    Сохранить график <i class="fas fa-save ml-1"></i>
                                </button>
                            </div>
                        </div>

                        <div class="overflow-x-auto">
                            <table id="admin-schedule-table" class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Сотрудник</th>
                                        <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Понедельник</th>
                                        <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Вторник</th>
                                        <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Среда</th>
                                        <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Четверг</th>
                                        <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Пятница</th>
                                        <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Суббота</th>
                                        <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Воскресенье</th>
                                    </tr>
                                </thead>
                                <tbody id="admin-schedule-body" class="bg-white divide-y divide-gray-200">
                                    <tr>
                                        <td colspan="8" class="px-6 py-4 text-center text-gray-500">Загрузка данных...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Employees Admin -->
                    <div id="employees-admin-content" class="tab-content hidden">
                        <div class="mb-6">
                            <h3 class="text-lg font-medium text-gray-900 mb-2">Добавить нового сотрудника</h3>
                            <div class="flex flex-wrap gap-4">
                                <div class="flex-grow">
                                    <input type="text" id="new-employee-name" placeholder="Имя сотрудника" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                                </div>
                                <button id="add-employee" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition">
                                    Добавить <i class="fas fa-plus ml-1"></i>
                                </button>
                            </div>
                        </div>

                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Имя</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Действия</th>
                                    </tr>
                                </thead>
                                <tbody id="employees-list" class="bg-white divide-y divide-gray-200">
                                    <tr>
                                        <td colspan="3" class="px-6 py-4 text-center text-gray-500">Загрузка данных...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Overtime Admin -->
                    <div id="overtime-admin-content" class="tab-content hidden">
                        <div class="mb-6 flex flex-wrap items-center gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Неделя:</label>
                                <div class="flex items-center gap-2">
                                    <button id="overtime-prev-week" class="bg-gray-200 hover:bg-gray-300 p-2 rounded-full">
                                        <i class="fas fa-chevron-left"></i>
                                    </button>
                                    <span id="overtime-week-display" class="font-medium">Загрузка...</span>
                                    <button id="overtime-next-week" class="bg-gray-200 hover:bg-gray-300 p-2 rounded-full">
                                        <i class="fas fa-chevron-right"></i>
                                    </button>
                                </div>
                            </div>
                            <div>
                                <button id="save-overtime" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition">
                                    Сохранить овертаймы <i class="fas fa-save ml-1"></i>
                                </button>
                            </div>
                        </div>

                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Сотрудник</th>
                                        <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Понедельник</th>
                                        <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Вторник</th>
                                        <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Среда</th>
                                        <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Четверг</th>
                                        <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Пятница</th>
                                        <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Суббота</th>
                                        <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Воскресенье</th>
                                    </tr>
                                </thead>
                                <tbody id="overtime-body" class="bg-white divide-y divide-gray-200">
                                    <tr>
                                        <td colspan="8" class="px-6 py-4 text-center text-gray-500">Загрузка данных...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Supabase configuration
        const supabaseUrl = 'https://brhrqswautuamwkworrf.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJyaHJxc3dhdXR1YW13a3dvcnJmIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc0NTgyNTk3NSwiZXhwIjoyMDYxNDAxOTc1fQ.HBxafrvjO2-PnrBQp7Obc5dFFZWO_p5DQySUDZu-IfI';
        const supabase = supabase.createClient(supabaseUrl, supabaseKey);

        // Global variables
        let currentWeekStart = getMonday(new Date());
        let employees = [];
        let schedules = {};
        let overtimes = {};
        let selectedEmployeeId = 'all';
        let isAdminLoggedIn = false;

        // DOM elements
        const employeeSelect = document.getElementById('employee-select');
        const weekDisplay = document.getElementById('week-display');
        const scheduleBody = document.getElementById('schedule-body');
        const prevWeekBtn = document.getElementById('prev-week');
        const nextWeekBtn = document.getElementById('next-week');
        
        // Login elements
        const loginModal = document.getElementById('login-modal');
        const closeLoginBtn = document.getElementById('close-login');
        const loginForm = document.getElementById('login-form');
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const loginError = document.getElementById('login-error');
        
        // Admin elements
        const toggleAdminBtn = document.getElementById('toggle-admin');
        const adminPanel = document.getElementById('admin-panel');
        const closeAdminBtn = document.getElementById('close-admin');
        const adminWeekDisplay = document.getElementById('admin-week-display');
        const adminScheduleBody = document.getElementById('admin-schedule-body');
        const adminPrevWeekBtn = document.getElementById('admin-prev-week');
        const adminNextWeekBtn = document.getElementById('admin-next-week');
        const saveScheduleBtn = document.getElementById('save-schedule');
        
        // Tabs
        const scheduleTab = document.getElementById('schedule-tab');
        const employeesTab = document.getElementById('employees-tab');
        const overtimeTab = document.getElementById('overtime-tab');
        const scheduleAdminContent = document.getElementById('schedule-admin-content');
        const employeesAdminContent = document.getElementById('employees-admin-content');
        const overtimeAdminContent = document.getElementById('overtime-admin-content');
        
        // Employees admin
        const newEmployeeName = document.getElementById('new-employee-name');
        const addEmployeeBtn = document.getElementById('add-employee');
        const employeesList = document.getElementById('employees-list');
        
        // Overtime admin
        const overtimeWeekDisplay = document.getElementById('overtime-week-display');
        const overtimeBody = document.getElementById('overtime-body');
        const overtimePrevWeekBtn = document.getElementById('overtime-prev-week');
        const overtimeNextWeekBtn = document.getElementById('overtime-next-week');
        const saveOvertimeBtn = document.getElementById('save-overtime');

        // Initialize the app
        document.addEventListener('DOMContentLoaded', async () => {
            // Load employees
            await loadEmployees();
            
            // Load initial schedule
            await loadSchedule(currentWeekStart);
            await loadOvertime(currentWeekStart);
            
            // Update UI
            updateWeekDisplay();
            updateAdminWeekDisplay();
            updateOvertimeWeekDisplay();
            
            // Set up event listeners
            setupEventListeners();
        });

        // Helper functions
        function getMonday(date) {
            const d = new Date(date);
            const day = d.getDay();
            const diff = d.getDate() - day + (day === 0 ? -6 : 1); // adjust when day is Sunday
            return new Date(d.setDate(diff));
        }

        function formatDate(date) {
            const options = { day: 'numeric', month: 'long', year: 'numeric' };
            return date.toLocaleDateString('ru-RU', options);
        }

        function getWeekDates(startDate) {
            const dates = [];
            for (let i = 0; i < 7; i++) {
                const date = new Date(startDate);
                date.setDate(date.getDate() + i);
                dates.push(date);
            }
            return dates;
        }

        function getWeekKey(date) {
            const d = new Date(date);
            d.setHours(0, 0, 0, 0);
            const year = d.getFullYear();
            const month = d.getMonth() + 1;
            const day = d.getDate();
            return `${year}-${month.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
        }

        // Data loading functions
        async function loadEmployees() {
            try {
                const { data, error } = await supabase
                    .from('employees')
                    .select('*')
                    .order('name', { ascending: true });
                
                if (error) throw error;
                
                employees = data;
                populateEmployeeSelect();
                populateEmployeesList();
            } catch (error) {
                console.error('Error loading employees:', error);
                alert('Ошибка загрузки списка сотрудников');
            }
        }

        async function loadSchedule(weekStart) {
            const weekKey = getWeekKey(weekStart);
            
            // Check if we already have this week's data
            if (schedules[weekKey]) {
                return;
            }
            
            const weekDates = getWeekDates(weekStart);
            const startDate = weekDates[0];
            const endDate = weekDates[6];
            
            try {
                const { data, error } = await supabase
                    .from('schedule')
                    .select(`
                        employee_id,
                        date,
                        is_working,
                        employees (name)
                    `)
                    .gte('date', startDate.toISOString().split('T')[0])
                    .lte('date', endDate.toISOString().split('T')[0]);
                
                if (error) throw error;
                
                // Organize data by employee
                const scheduleData = {};
                employees.forEach(emp => {
                    scheduleData[emp.id] = {};
                    weekDates.forEach(date => {
                        scheduleData[emp.id][date.toISOString().split('T')[0]] = {
                            is_working: false, // default
                            employee_name: emp.name
                        };
                    });
                });
                
                // Fill with actual data
                data.forEach(item => {
                    if (scheduleData[item.employee_id]) {
                        scheduleData[item.employee_id][item.date] = {
                            is_working: item.is_working,
                            employee_name: item.employees.name
                        };
                    }
                });
                
                // Store in cache
                schedules[weekKey] = scheduleData;
                
                // Update UI
                updateScheduleTable();
                updateAdminScheduleTable();
            } catch (error) {
                console.error('Error loading schedule:', error);
                alert('Ошибка загрузки графика');
            }
        }

        async function loadOvertime(weekStart) {
            const weekKey = getWeekKey(weekStart);
            
            // Check if we already have this week's data
            if (overtimes[weekKey]) {
                return;
            }
            
            const weekDates = getWeekDates(weekStart);
            const startDate = weekDates[0];
            const endDate = weekDates[6];
            
            try {
                const { data, error } = await supabase
                    .from('overtime')
                    .select(`
                        employee_id,
                        date,
                        hours,
                        employees (name)
                    `)
                    .gte('date', startDate.toISOString().split('T')[0])
                    .lte('date', endDate.toISOString().split('T')[0]);
                
                if (error) throw error;
                
                // Organize data by employee
                const overtimeData = {};
                employees.forEach(emp => {
                    overtimeData[emp.id] = {};
                    weekDates.forEach(date => {
                        overtimeData[emp.id][date.toISOString().split('T')[0]] = {
                            hours: 0, // default
                            employee_name: emp.name
                        };
                    });
                });
                
                // Fill with actual data
                data.forEach(item => {
                    if (overtimeData[item.employee_id]) {
                        overtimeData[item.employee_id][item.date] = {
                            hours: item.hours,
                            employee_name: item.employees.name
                        };
                    }
                });
                
                // Store in cache
                overtimes[weekKey] = overtimeData;
                
                // Update UI
                updateOvertimeTable();
            } catch (error) {
                console.error('Error loading overtime:', error);
                alert('Ошибка загрузки овертаймов');
            }
        }

        // UI update functions
        function populateEmployeeSelect() {
            employeeSelect.innerHTML = '';
            
            const allOption = document.createElement('option');
            allOption.value = 'all';
            allOption.textContent = 'Все сотрудники';
            employeeSelect.appendChild(allOption);
            
            employees.forEach(employee => {
                const option = document.createElement('option');
                option.value = employee.id;
                option.textContent = employee.name;
                employeeSelect.appendChild(option);
            });
        }

        function populateEmployeesList() {
            employeesList.innerHTML = '';
            
            if (employees.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="3" class="px-6 py-4 text-center text-gray-500">Нет сотрудников</td>';
                employeesList.appendChild(row);
                return;
            }
            
            employees.forEach(employee => {
                const row = document.createElement('tr');
                
                const idCell = document.createElement('td');
                idCell.className = 'px-6 py-4 whitespace-nowrap text-sm text-gray-500';
                idCell.textContent = employee.id;
                
                const nameCell = document.createElement('td');
                nameCell.className = 'px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900';
                
                const nameInput = document.createElement('input');
                nameInput.type = 'text';
                nameInput.value = employee.name;
                nameInput.className = 'px-2 py-1 border border-gray-300 rounded focus:ring-indigo-500 focus:border-indigo-500';
                nameInput.dataset.employeeId = employee.id;
                
                nameCell.appendChild(nameInput);
                
                const actionsCell = document.createElement('td');
                actionsCell.className = 'px-6 py-4 whitespace-nowrap text-right text-sm font-medium';
                
                const saveBtn = document.createElement('button');
                saveBtn.className = 'text-indigo-600 hover:text-indigo-900 mr-4';
                saveBtn.innerHTML = '<i class="fas fa-save"></i> Сохранить';
                saveBtn.dataset.employeeId = employee.id;
                saveBtn.addEventListener('click', saveEmployeeName);
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'text-red-600 hover:text-red-900';
                deleteBtn.innerHTML = '<i class="fas fa-trash"></i> Удалить';
                deleteBtn.dataset.employeeId = employee.id;
                deleteBtn.addEventListener('click', deleteEmployee);
                
                actionsCell.appendChild(saveBtn);
                actionsCell.appendChild(deleteBtn);
                
                row.appendChild(idCell);
                row.appendChild(nameCell);
                row.appendChild(actionsCell);
                
                employeesList.appendChild(row);
            });
        }

        function updateWeekDisplay() {
            const weekDates = getWeekDates(currentWeekStart);
            const startDate = weekDates[0];
            const endDate = weekDates[6];
            weekDisplay.textContent = `${formatDate(startDate)} - ${formatDate(endDate)}`;
        }

        function updateAdminWeekDisplay() {
            const weekDates = getWeekDates(currentWeekStart);
            const startDate = weekDates[0];
            const endDate = weekDates[6];
            adminWeekDisplay.textContent = `${formatDate(startDate)} - ${formatDate(endDate)}`;
        }

        function updateOvertimeWeekDisplay() {
            const weekDates = getWeekDates(currentWeekStart);
            const startDate = weekDates[0];
            const endDate = weekDates[6];
            overtimeWeekDisplay.textContent = `${formatDate(startDate)} - ${formatDate(endDate)}`;
        }

        function updateScheduleTable() {
            const weekKey = getWeekKey(currentWeekStart);
            const weekData = schedules[weekKey];
            
            if (!weekData) {
                scheduleBody.innerHTML = '<tr><td colspan="8" class="px-6 py-4 text-center text-gray-500">Данные не загружены</td></tr>';
                return;
            }
            
            scheduleBody.innerHTML = '';
            
            // Filter employees based on selection
            const displayEmployees = selectedEmployeeId === 'all' 
                ? employees 
                : employees.filter(emp => emp.id === selectedEmployeeId);
            
            if (displayEmployees.length === 0) {
                scheduleBody.innerHTML =
</html>
